<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Interview Answer Save Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ Mock Interview Answer Save Test</h1>
        <p>æµ‹è¯•Mock Interviewé¡µé¢çš„ç­”æ¡ˆä¿å­˜åŠŸèƒ½</p>
        
        <div class="test-section">
            <h3>1. è®¾ç½®è®¤è¯Token</h3>
            <button onclick="setAuthToken()">è®¾ç½®æµ‹è¯•ç”¨æˆ·Token</button>
            <div id="auth-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. åˆ›å»ºMocké¢è¯•ä¼šè¯</h3>
            <button onclick="createMockInterview()">åˆ›å»ºMocké¢è¯•</button>
            <div id="create-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. å¯åŠ¨é¢è¯•ä¼šè¯</h3>
            <button onclick="startInterview()" id="start-btn" disabled>å¯åŠ¨é¢è¯•</button>
            <div id="start-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>4. æäº¤æµ‹è¯•ç­”æ¡ˆ</h3>
            <button onclick="submitTestAnswer()" id="submit-btn" disabled>æäº¤ç­”æ¡ˆ</button>
            <div id="submit-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>5. éªŒè¯Question Bank</h3>
            <button onclick="checkQuestionBank()" id="check-btn" disabled>æ£€æŸ¥Question Bank</button>
            <div id="check-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>6. ç»“æŸé¢è¯•</h3>
            <button onclick="endInterview()" id="end-btn" disabled>ç»“æŸé¢è¯•</button>
            <div id="end-result" class="result"></div>
        </div>
    </div>

    <script>
        let sessionId = null;
        let questionId = null;
        let currentQuestion = null;

        // è®¾ç½®è®¤è¯Token
        function setAuthToken() {
            const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTc1MDU2NTc5MywianRpIjoiY2ViMjQ0MWUtMTUzYi00MjI4LWI0NzktNmYwYTBhN2Q0NzZiIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjIiLCJuYmYiOjE3NTA1NjU3OTMsImNzcmYiOiJlNGNjNWJhYS1lZDM1LTQ0MTItOTM0Yy1kNjdjMWRlMWY3NjEifQ.BWFeQ6PsbznBFnUYrFYC-2A6X2g5Vz23HFkLHcfSLbg';
            localStorage.setItem('access_token', token);
            
            document.getElementById('auth-result').innerHTML = 'âœ… Tokenå·²è®¾ç½®';
            document.getElementById('auth-result').className = 'result success';
        }

        // åˆ›å»ºMocké¢è¯•ä¼šè¯
        async function createMockInterview() {
            try {
                const token = localStorage.getItem('access_token');
                
                const response = await fetch('http://localhost:5001/api/v1/interviews', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        resume_id: 1, // ä½¿ç”¨æµ‹è¯•ç®€å†ID
                        interview_type: 'mock',
                        total_questions: 3,
                        custom_title: 'Mock Interview Test',
                        difficulty_distribution: {
                            'easy': 1,
                            'medium': 1,
                            'hard': 1
                        },
                        type_distribution: {
                            'behavioral': 1,
                            'technical': 1,
                            'situational': 1
                        }
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    sessionId = data.data.session_id;
                    document.getElementById('create-result').innerHTML = `âœ… Mocké¢è¯•ä¼šè¯åˆ›å»ºæˆåŠŸï¼\nSession ID: ${sessionId}`;
                    document.getElementById('create-result').className = 'result success';
                    document.getElementById('start-btn').disabled = false;
                } else {
                    throw new Error(data.message || 'åˆ›å»ºå¤±è´¥');
                }
            } catch (error) {
                document.getElementById('create-result').innerHTML = `âŒ åˆ›å»ºå¤±è´¥: ${error.message}`;
                document.getElementById('create-result').className = 'result error';
            }
        }

        // å¯åŠ¨é¢è¯•ä¼šè¯
        async function startInterview() {
            try {
                const token = localStorage.getItem('access_token');
                
                const response = await fetch(`http://localhost:5001/api/v1/interviews/${sessionId}/start`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    currentQuestion = data.data.next_question;
                    questionId = currentQuestion.id;
                    
                    document.getElementById('start-result').innerHTML = `âœ… é¢è¯•å·²å¯åŠ¨ï¼\nç¬¬ä¸€ä¸ªé—®é¢˜: ${currentQuestion.question_text}`;
                    document.getElementById('start-result').className = 'result success';
                    document.getElementById('submit-btn').disabled = false;
                } else {
                    throw new Error(data.message || 'å¯åŠ¨å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('start-result').innerHTML = `âŒ å¯åŠ¨å¤±è´¥: ${error.message}`;
                document.getElementById('start-result').className = 'result error';
            }
        }

        // æäº¤æµ‹è¯•ç­”æ¡ˆ
        async function submitTestAnswer() {
            try {
                const token = localStorage.getItem('access_token');
                const testAnswer = `è¿™æ˜¯æˆ‘å¯¹é—®é¢˜"${currentQuestion.question_text}"çš„æµ‹è¯•å›ç­”ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜å¾ˆæœ‰æŒ‘æˆ˜æ€§ï¼Œéœ€è¦ä»å¤šä¸ªè§’åº¦æ¥åˆ†æ...`;
                
                const response = await fetch(`http://localhost:5001/api/v1/interviews/${sessionId}/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        question_id: questionId,
                        answer_text: testAnswer,
                        response_time: 60
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('submit-result').innerHTML = `âœ… ç­”æ¡ˆæäº¤æˆåŠŸï¼\nç­”æ¡ˆID: ${data.data.answer_id}\nä¼šè¯çŠ¶æ€: ${data.data.session_completed ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}`;
                    document.getElementById('submit-result').className = 'result success';
                    document.getElementById('check-btn').disabled = false;
                    document.getElementById('end-btn').disabled = false;
                } else {
                    throw new Error(data.message || 'æäº¤å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('submit-result').innerHTML = `âŒ æäº¤å¤±è´¥: ${error.message}`;
                document.getElementById('submit-result').className = 'result error';
            }
        }

        // æ£€æŸ¥Question Bank
        async function checkQuestionBank() {
            try {
                const token = localStorage.getItem('access_token');
                
                const response = await fetch('http://localhost:5001/api/v1/questions/with-answers?page=1&per_page=10&has_answers=true', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    const questions = data.data.questions;
                    const mockQuestions = questions.filter(q => q.interview_type === 'mock');
                    
                    document.getElementById('check-result').innerHTML = `âœ… Question BankæŸ¥è¯¢æˆåŠŸï¼\næ€»é—®é¢˜æ•°: ${questions.length}\nMocké¢è¯•é—®é¢˜æ•°: ${mockQuestions.length}\n\næœ€æ–°Mocké—®é¢˜:\n${mockQuestions.slice(0, 3).map(q => `- ${q.question_text.substring(0, 50)}... (${q.interview_type})`).join('\n')}`;
                    document.getElementById('check-result').className = 'result success';
                } else {
                    throw new Error(data.message || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('check-result').innerHTML = `âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}`;
                document.getElementById('check-result').className = 'result error';
            }
        }

        // ç»“æŸé¢è¯•
        async function endInterview() {
            try {
                const token = localStorage.getItem('access_token');
                
                const response = await fetch(`http://localhost:5001/api/v1/interviews/${sessionId}/end`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('end-result').innerHTML = `âœ… é¢è¯•å·²ç»“æŸï¼\nä¼šè¯çŠ¶æ€: ${data.data.session.status}`;
                    document.getElementById('end-result').className = 'result success';
                } else {
                    throw new Error(data.message || 'ç»“æŸå¤±è´¥');
                }
            } catch (error) {
                document.getElementById('end-result').innerHTML = `âŒ ç»“æŸå¤±è´¥: ${error.message}`;
                document.getElementById('end-result').className = 'result error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è®¾ç½®token
        window.onload = function() {
            setAuthToken();
        };
    </script>
</body>
</html> 