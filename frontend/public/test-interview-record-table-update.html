<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ é¢è¯•è®°å½•è¡¨æ ¼æ›´æ–°éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e3f2fd;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 15px;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .result-area {
            background: #f1f8e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            background: #ffebee;
            border-color: #ffcdd2;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-color: #c8e6c9;
            color: #2e7d32;
        }
        
        .table-preview {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        .table-preview table {
            width: 100%;
            border-collapse: collapse;
        }
        .table-preview th {
            background: #F8FAFB;
            border-bottom: 1px solid #E5E7EB;
            padding: 12px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .table-preview td {
            padding: 16px 12px;
            border-bottom: 1px solid #E5E7EB;
            font-size: 14px;
            color: #282828;
        }
        .table-preview tr:hover {
            background: #F9FAFB;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-completed { background: #E8F5E8; color: #2D7738; }
        .status-in-progress { background: #FEF3C7; color: #92400E; }
        .status-abandoned { background: #FEE2E2; color: #B91C1C; }
        .status-ready { background: #EEF9FF; color: #1B5E8C; }
        .status-created { background: #F3F4F6; color: #6B7280; }
        
        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }
        .type-mock { background: #E8F5E8; color: #2D7738; }
        .type-formal { background: #EEF9FF; color: #1B5E8C; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ é¢è¯•è®°å½•è¡¨æ ¼æ›´æ–°éªŒè¯</h1>
            <p>æµ‹è¯•æ–°å¢çš„çŠ¶æ€åˆ—å’Œæ—¶é•¿æ ¼å¼ (hh:mm:ss)</p>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“ 1. ç™»å½•å¹¶è·å–Token</div>
            <button class="test-button" onclick="testLogin()">ç™»å½•æµ‹è¯•</button>
            <div id="loginResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“‹ 2. è·å–é¢è¯•è®°å½•æ•°æ®</div>
            <button class="test-button" onclick="getInterviewRecords()">è·å–é¢è¯•è®°å½•</button>
            <div id="recordsResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ§ª 3. æµ‹è¯•æ—¶é•¿æ ¼å¼åŒ–å‡½æ•°</div>
            <button class="test-button" onclick="testDurationFormatting()">æµ‹è¯•æ—¶é•¿æ ¼å¼åŒ–</button>
            <div id="durationResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ¨ 4. æµ‹è¯•çŠ¶æ€æ ¼å¼åŒ–å‡½æ•°</div>
            <button class="test-button" onclick="testStatusFormatting()">æµ‹è¯•çŠ¶æ€æ ¼å¼åŒ–</button>
            <div id="statusResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“Š 5. é¢„è§ˆè¡¨æ ¼æ•ˆæœ</div>
            <button class="test-button" onclick="previewTable()">é¢„è§ˆè¡¨æ ¼</button>
            <div id="tablePreview" style="display:none;"></div>
        </div>
    </div>

    <script>
        let authToken = '';
        
        // ç™»å½•æµ‹è¯•
        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨ç™»å½•...';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: '3938930977@qq.com',
                        password: '12345678'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.data.access_token;
                    resultDiv.className = 'result-area success';
                    resultDiv.textContent = `âœ… ç™»å½•æˆåŠŸï¼\nToken: ${authToken.substring(0, 50)}...`;
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ ç™»å½•å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ ç™»å½•å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // è·å–é¢è¯•è®°å½•
        async function getInterviewRecords() {
            const resultDiv = document.getElementById('recordsResult');
            resultDiv.style.display = 'block';
            
            if (!authToken) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = 'âŒ è¯·å…ˆç™»å½•è·å–Token';
                return;
            }
            
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨è·å–é¢è¯•è®°å½•...';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/interviews?page=1&per_page=50', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result-area success';
                    
                    // æ ¼å¼åŒ–è®°å½•ä»¥ä¾¿æµ‹è¯•
                    const formattedRecords = data.data.sessions.map(session => {
                        const formatDuration = (startTime, endTime) => {
                            const start = new Date(startTime);
                            const end = endTime ? new Date(endTime) : new Date();
                            const diffMs = Math.max(0, end.getTime() - start.getTime());
                            
                            const hours = Math.floor(diffMs / 3600000);
                            const minutes = Math.floor((diffMs % 3600000) / 60000);
                            const seconds = Math.floor((diffMs % 60000) / 1000);
                            
                            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        };
                        
                        const formatStatus = (status) => {
                            switch (status.toLowerCase()) {
                                case 'completed': return { text: 'Completed', className: 'status-completed' };
                                case 'in_progress': return { text: 'In Progress', className: 'status-in-progress' };
                                case 'abandoned': return { text: 'Abandoned', className: 'status-abandoned' };
                                case 'ready': return { text: 'Ready', className: 'status-ready' };
                                case 'created': return { text: 'Created', className: 'status-created' };
                                default: return { text: status, className: 'status-created' };
                            }
                        };
                        
                        return {
                            id: session.session_id,
                            title: session.title,
                            duration: formatDuration(session.started_at || session.created_at, session.completed_at),
                            status: session.status,
                            statusFormatted: formatStatus(session.status),
                            interview_type: session.interview_type
                        };
                    });
                    
                    resultDiv.textContent = `âœ… è·å–æˆåŠŸï¼å…± ${formattedRecords.length} æ¡è®°å½•\n\n` + 
                        JSON.stringify(formattedRecords, null, 2);
                    
                    // ä¿å­˜åˆ°å…¨å±€å˜é‡ä¾›å…¶ä»–å‡½æ•°ä½¿ç”¨
                    window.testRecords = formattedRecords;
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ è·å–å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // æµ‹è¯•æ—¶é•¿æ ¼å¼åŒ–
        function testDurationFormatting() {
            const resultDiv = document.getElementById('durationResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-area success';
            
            const formatDuration = (startTime, endTime) => {
                const start = new Date(startTime);
                const end = endTime ? new Date(endTime) : new Date();
                const diffMs = Math.max(0, end.getTime() - start.getTime());
                
                const hours = Math.floor(diffMs / 3600000);
                const minutes = Math.floor((diffMs % 3600000) / 60000);
                const seconds = Math.floor((diffMs % 60000) / 1000);
                
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            };
            
            const testCases = [
                { start: '2025-08-04T10:00:00Z', end: '2025-08-04T10:30:45Z', desc: '30åˆ†45ç§’çš„é¢è¯•' },
                { start: '2025-08-04T10:00:00Z', end: '2025-08-04T11:15:30Z', desc: '1å°æ—¶15åˆ†30ç§’çš„é¢è¯•' },
                { start: '2025-08-04T10:00:00Z', end: '2025-08-04T10:05:15Z', desc: '5åˆ†15ç§’çš„é¢è¯•' },
                { start: '2025-08-04T10:00:00Z', end: null, desc: 'è¿›è¡Œä¸­çš„é¢è¯•ï¼ˆåˆ°ç°åœ¨ï¼‰' }
            ];
            
            let result = 'ğŸ§ª æ—¶é•¿æ ¼å¼åŒ–æµ‹è¯•ç»“æœ:\n\n';
            testCases.forEach((testCase, index) => {
                const duration = formatDuration(testCase.start, testCase.end);
                result += `${index + 1}. ${testCase.desc}\n`;
                result += `   å¼€å§‹æ—¶é—´: ${testCase.start}\n`;
                result += `   ç»“æŸæ—¶é—´: ${testCase.end || 'è¿›è¡Œä¸­'}\n`;
                result += `   æ ¼å¼åŒ–ç»“æœ: ${duration}\n\n`;
            });
            
            resultDiv.textContent = result;
        }
        
        // æµ‹è¯•çŠ¶æ€æ ¼å¼åŒ–
        function testStatusFormatting() {
            const resultDiv = document.getElementById('statusResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-area success';
            
            const formatStatus = (status) => {
                switch (status.toLowerCase()) {
                    case 'completed': return { text: 'Completed', className: 'bg-[#E8F5E8] text-[#2D7738]' };
                    case 'in_progress': return { text: 'In Progress', className: 'bg-[#FEF3C7] text-[#92400E]' };
                    case 'abandoned': return { text: 'Abandoned', className: 'bg-[#FEE2E2] text-[#B91C1C]' };
                    case 'ready': return { text: 'Ready', className: 'bg-[#EEF9FF] text-[#1B5E8C]' };
                    case 'created': return { text: 'Created', className: 'bg-[#F3F4F6] text-[#6B7280]' };
                    default: return { text: status, className: 'bg-[#F3F4F6] text-[#6B7280]' };
                }
            };
            
            const statusList = ['completed', 'in_progress', 'abandoned', 'ready', 'created', 'unknown'];
            
            let result = 'ğŸ¨ çŠ¶æ€æ ¼å¼åŒ–æµ‹è¯•ç»“æœ:\n\n';
            statusList.forEach(status => {
                const formatted = formatStatus(status);
                result += `çŠ¶æ€: "${status}" â†’ æ˜¾ç¤º: "${formatted.text}" | æ ·å¼: ${formatted.className}\n`;
            });
            
            resultDiv.textContent = result;
        }
        
        // é¢„è§ˆè¡¨æ ¼æ•ˆæœ
        function previewTable() {
            const previewDiv = document.getElementById('tablePreview');
            previewDiv.style.display = 'block';
            
            // ä½¿ç”¨æµ‹è¯•æ•°æ®æˆ–æ¼”ç¤ºæ•°æ®
            const records = window.testRecords || [
                {
                    id: 'ac5545af-1d34-41e5-b1da-e5fffa0bcacd',
                    title: 'Product Manager Mock Interview',
                    duration: '01:23:45',
                    status: 'abandoned',
                    statusFormatted: { text: 'Abandoned', className: 'status-abandoned' },
                    interview_type: 'mock'
                },
                {
                    id: 'demo-completed',
                    title: 'Software Engineer Interview',
                    duration: '00:45:30',
                    status: 'completed',
                    statusFormatted: { text: 'Completed', className: 'status-completed' },
                    interview_type: 'comprehensive'
                },
                {
                    id: 'demo-in-progress',
                    title: 'Data Analyst Interview',
                    duration: '00:15:22',
                    status: 'in_progress',
                    statusFormatted: { text: 'In Progress', className: 'status-in-progress' },
                    interview_type: 'mock'
                }
            ];
            
            const convertInterviewType = (type) => {
                const cleanType = type.includes('.') ? type.split('.').pop()?.toLowerCase() : type.toLowerCase();
                switch (cleanType) {
                    case 'mock': return 'Mock Interview';
                    case 'technical':
                    case 'hr':
                    case 'comprehensive': return 'Formal interview';
                    default: return 'Mock Interview';
                }
            };
            
            let tableHTML = `
                <div class="table-preview">
                    <table>
                        <thead>
                            <tr>
                                <th>Interview ID</th>
                                <th>Date</th>
                                <th>Duration</th>
                                <th>Interview Type</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            records.forEach(record => {
                const interviewType = convertInterviewType(record.interview_type);
                const typeClass = interviewType === 'Mock Interview' ? 'type-mock' : 'type-formal';
                
                tableHTML += `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div style="width: 40px; height: 40px; background: #EEF9FF; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                    <svg style="width: 24px; height: 24px; color: #68C6F1;" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">${record.title}</div>
                                    <div style="font-size: 12px; color: #6B7280;">#${record.id.substring(0, 8)}...</div>
                                </div>
                            </div>
                        </td>
                        <td>2025/08/04</td>
                        <td><strong>${record.duration}</strong></td>
                        <td>
                            <span class="status-badge ${typeClass}">${interviewType}</span>
                        </td>
                        <td>
                            <span class="status-badge ${record.statusFormatted.className}">${record.statusFormatted.text}</span>
                        </td>
                        <td>
                            <button style="background: #68C6F1; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; margin-right: 8px;">Review</button>
                            <button style="background: #F87171; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px;">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            previewDiv.innerHTML = `
                <h4>ğŸ“Š è¡¨æ ¼é¢„è§ˆæ•ˆæœï¼š</h4>
                ${tableHTML}
                <p style="margin-top: 15px; color: #666; font-size: 14px;">
                    âœ… æ–°å¢äº† "Status" åˆ—æ˜¾ç¤ºé¢è¯•çŠ¶æ€<br>
                    âœ… Duration æ ¼å¼æ”¹ä¸º hh:mm:ss æ ¼å¼<br>
                    âœ… çŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²çš„å¾½ç« æ˜¾ç¤º
                </p>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ¯ é¢è¯•è®°å½•è¡¨æ ¼æ›´æ–°éªŒè¯é¡µé¢å·²åŠ è½½');
            console.log('è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•ï¼š1. ç™»å½• â†’ 2. è·å–è®°å½• â†’ 3. æµ‹è¯•æ ¼å¼åŒ– â†’ 4. é¢„è§ˆè¡¨æ ¼');
        });
    </script>
</body>
</html> 