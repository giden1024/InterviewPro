<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é”™è¯¯ä¿¡æ¯ä¿®å¤éªŒè¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold text-center mb-6">ğŸ”§ ç™»å½•é”™è¯¯ä¿¡æ¯ä¿®å¤éªŒè¯</h1>
            
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
                <p class="font-bold">âœ… ä¿®å¤å†…å®¹ï¼š</p>
                <ul class="text-sm mt-2 space-y-1">
                    <li>â€¢ 401é”™è¯¯ç°åœ¨è¿”å›å…·ä½“é”™è¯¯ä¿¡æ¯</li>
                    <li>â€¢ æ”¯æŒä¸­è‹±æ–‡é”™è¯¯ä¿¡æ¯åŒ¹é…</li>
                    <li>â€¢ é¿å…åœ¨ç™»å½•é¡µé¢æ— é™è·³è½¬</li>
                </ul>
            </div>

            <div class="space-y-4">
                <h2 class="text-lg font-semibold">æµ‹è¯•åœºæ™¯ï¼š</h2>
                
                <button onclick="testWrongPassword()" 
                        class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">
                    ğŸ”’ æµ‹è¯•é”™è¯¯å¯†ç ï¼ˆåº”æ˜¾ç¤ºï¼šå¯†ç é”™è¯¯ï¼‰
                </button>
                
                <button onclick="testWrongEmail()" 
                        class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded">
                    ğŸ“§ æµ‹è¯•ä¸å­˜åœ¨é‚®ç®±ï¼ˆåº”æ˜¾ç¤ºï¼šé‚®ç®±æœªæ³¨å†Œï¼‰
                </button>
                
                <button onclick="testCorrectCredentials()" 
                        class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">
                    âœ…æµ‹è¯•æ­£ç¡®å‡­æ®ï¼ˆåº”ç™»å½•æˆåŠŸï¼‰
                </button>
            </div>

            <div id="result" class="mt-6 p-4 rounded hidden">
                <!-- æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>

            <div id="logs" class="mt-6 bg-gray-100 p-4 rounded text-xs overflow-x-auto max-h-60 overflow-y-auto">
                <h3 class="font-bold mb-2">è°ƒè¯•æ—¥å¿—ï¼š</h3>
                <div id="logContent"></div>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-red-600' : 
                             type === 'success' ? 'text-green-600' : 
                             type === 'warn' ? 'text-yellow-600' : 
                             'text-blue-600';
            
            logContent.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
        }

        function showResult(message, isSuccess = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `mt-6 p-4 rounded ${
                isSuccess ? 'bg-green-100 border border-green-400 text-green-700' : 
                'bg-red-100 border border-red-400 text-red-700'
            }`;
            resultDiv.innerHTML = `<p class="font-bold">${isSuccess ? 'âœ… æˆåŠŸ:' : 'âŒ é”™è¯¯:'}</p><p class="text-sm mt-1">${message}</p>`;
            resultDiv.classList.remove('hidden');
        }

        async function testLoginRequest(email, password, expectedError) {
            log(`å¼€å§‹æµ‹è¯•ç™»å½•ï¼š${email}`);
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();
                log(`APIå“åº”çŠ¶æ€ï¼š${response.status}`);
                log(`APIå“åº”æ•°æ®ï¼š${JSON.stringify(data, null, 2)}`, 'info');

                if (!response.ok) {
                    // æ¨¡æ‹Ÿå‰ç«¯é”™è¯¯å¤„ç†é€»è¾‘
                    let errorMessage = '';
                    
                    if (data.error && data.error.message) {
                        errorMessage = data.error.message;
                    } else if (data.message) {
                        errorMessage = data.message;
                    } else {
                        errorMessage = 'æœªçŸ¥é”™è¯¯';
                    }

                    log(`æå–çš„é”™è¯¯ä¿¡æ¯ï¼š${errorMessage}`, 'warn');

                    // æ¨¡æ‹Ÿå‰ç«¯å‹å¥½é”™è¯¯ä¿¡æ¯è½¬æ¢
                    let friendlyErrorMessage = '';
                    
                    if (errorMessage.includes('ç”¨æˆ·ä¸å­˜åœ¨') || errorMessage.includes('ç”¨æˆ·åä¸å­˜åœ¨') || 
                        errorMessage.includes('User not found') || errorMessage.includes('user does not exist')) {
                        friendlyErrorMessage = 'è¯¥é‚®ç®±å°šæœªæ³¨å†Œï¼Œè¯·æ£€æŸ¥é‚®ç®±åœ°å€æˆ–ç‚¹å‡»ä¸‹æ–¹"Sign up"æ³¨å†Œæ–°è´¦æˆ·';
                    } else if (errorMessage.includes('å¯†ç é”™è¯¯') || errorMessage.includes('å¯†ç ä¸æ­£ç¡®') || 
                               errorMessage.includes('Incorrect password') || errorMessage.includes('Invalid password') ||
                               errorMessage.includes('password is incorrect')) {
                        friendlyErrorMessage = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥æ­£ç¡®å¯†ç ';
                    } else {
                        friendlyErrorMessage = errorMessage;
                    }

                    log(`å‹å¥½é”™è¯¯ä¿¡æ¯ï¼š${friendlyErrorMessage}`, 'error');
                    showResult(friendlyErrorMessage, false);
                    
                    // éªŒè¯æ˜¯å¦ç¬¦åˆé¢„æœŸ
                    if (expectedError && friendlyErrorMessage.includes(expectedError)) {
                        log(`âœ… æµ‹è¯•é€šè¿‡ï¼šé”™è¯¯ä¿¡æ¯ç¬¦åˆé¢„æœŸ`, 'success');
                    } else if (expectedError) {
                        log(`âŒ æµ‹è¯•å¤±è´¥ï¼šæœŸæœ›åŒ…å«"${expectedError}"ï¼Œå®é™…å¾—åˆ°"${friendlyErrorMessage}"`, 'error');
                    }
                } else {
                    log('ç™»å½•æˆåŠŸï¼', 'success');
                    showResult(`ç™»å½•æˆåŠŸï¼ç”¨æˆ·ï¼š${data.data.user.email}`, true);
                }
            } catch (error) {
                log(`ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼š${error.message}`, 'error');
                showResult(`ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼š${error.message}`, false);
            }
        }

        function testWrongPassword() {
            log('=== å¼€å§‹æµ‹è¯•é”™è¯¯å¯†ç åœºæ™¯ ===', 'warn');
            testLoginRequest('test@example.com', 'wrongpassword', 'å¯†ç é”™è¯¯');
        }

        function testWrongEmail() {
            log('=== å¼€å§‹æµ‹è¯•ä¸å­˜åœ¨é‚®ç®±åœºæ™¯ ===', 'warn');
            testLoginRequest('nonexistent@example.com', 'anypassword', 'é‚®ç®±å°šæœªæ³¨å†Œ');
        }

        function testCorrectCredentials() {
            log('=== å¼€å§‹æµ‹è¯•æ­£ç¡®å‡­æ®åœºæ™¯ ===', 'warn');
            testLoginRequest('test@example.com', '123456', null);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹ä¿¡æ¯
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•ç™»å½•é”™è¯¯ä¿¡æ¯ä¿®å¤æ•ˆæœ', 'info');
        });
    </script>
</body>
</html> 