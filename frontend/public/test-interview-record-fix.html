<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ é¢è¯•è®°å½•æ˜¾ç¤ºä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e3f2fd;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 15px;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .result-area {
            background: #f1f8e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #ffebee;
            border-color: #ffcdd2;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-color: #c8e6c9;
            color: #2e7d32;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-mock { background-color: #4caf50; }
        .status-formal { background-color: #2196f3; }
        .status-abandoned { background-color: #ff9800; }
        .status-completed { background-color: #9c27b0; }
        .status-in-progress { background-color: #f44336; }
        
        .record-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .record-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }
        .record-title {
            font-weight: bold;
            color: #333;
        }
        .record-meta {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ é¢è¯•è®°å½•æ˜¾ç¤ºä¿®å¤éªŒè¯</h1>
            <p>æµ‹è¯•ä¼šè¯ ac5545af-1d34-41e5-b1da-e5fffa0bcacd çš„æ˜¾ç¤ºä¿®å¤æ•ˆæœ</p>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“ 1. ç™»å½•å¹¶è·å–Token</div>
            <button class="test-button" onclick="testLogin()">ç™»å½•æµ‹è¯•</button>
            <div id="loginResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“‹ 2. è·å–é¢è¯•è®°å½•åŸå§‹æ•°æ®</div>
            <button class="test-button" onclick="getRawInterviewData()">è·å–åŸå§‹APIæ•°æ®</button>
            <div id="rawDataResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ”„ 3. æµ‹è¯•ç±»å‹è½¬æ¢é€»è¾‘</div>
            <button class="test-button" onclick="testTypeConversion()">æµ‹è¯•è½¬æ¢é€»è¾‘</button>
            <div id="conversionResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“Š 4. æ˜¾ç¤ºæ ¼å¼åŒ–åçš„è®°å½•</div>
            <button class="test-button" onclick="getFormattedRecords()">è·å–æ ¼å¼åŒ–è®°å½•</button>
            <div id="formattedResult" class="result-area" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ¯ 5. éªŒè¯ç›®æ ‡ä¼šè¯</div>
            <button class="test-button" onclick="verifyTargetSession()">éªŒè¯ç›®æ ‡ä¼šè¯</button>
            <div id="targetResult" class="result-area" style="display:none;"></div>
        </div>
    </div>

    <script>
        let authToken = '';
        
        // ç™»å½•æµ‹è¯•
        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨ç™»å½•...';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: '3938930977@qq.com',
                        password: '12345678'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.data.access_token;
                    resultDiv.className = 'result-area success';
                    resultDiv.textContent = `âœ… ç™»å½•æˆåŠŸï¼\nToken: ${authToken.substring(0, 50)}...`;
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ ç™»å½•å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ ç™»å½•å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // è·å–åŸå§‹é¢è¯•æ•°æ®
        async function getRawInterviewData() {
            const resultDiv = document.getElementById('rawDataResult');
            resultDiv.style.display = 'block';
            
            if (!authToken) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = 'âŒ è¯·å…ˆç™»å½•è·å–Token';
                return;
            }
            
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨è·å–é¢è¯•è®°å½•...';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/interviews?page=1&per_page=50', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result-area success';
                    resultDiv.textContent = `âœ… è·å–æˆåŠŸï¼å…± ${data.data.sessions.length} æ¡è®°å½•\n\n` + 
                        JSON.stringify(data.data, null, 2);
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ è·å–å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // æµ‹è¯•ç±»å‹è½¬æ¢é€»è¾‘
        function testTypeConversion() {
            const resultDiv = document.getElementById('conversionResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-area success';
            
            // å¤åˆ¶å‰ç«¯çš„è½¬æ¢é€»è¾‘
            const convertInterviewType = (type) => {
                const cleanType = type.includes('.') ? type.split('.').pop()?.toLowerCase() : type.toLowerCase();
                
                switch (cleanType) {
                    case 'mock':
                        return 'Mock Interview';
                    case 'technical':
                    case 'hr':
                    case 'comprehensive':
                        return 'Formal interview';
                    default:
                        return 'Mock Interview';
                }
            };
            
            const testCases = [
                'mock',
                'InterviewType.MOCK',
                'comprehensive',
                'InterviewType.COMPREHENSIVE',
                'technical',
                'unknown'
            ];
            
            let result = 'ğŸ§ª ç±»å‹è½¬æ¢æµ‹è¯•ç»“æœ:\n\n';
            testCases.forEach(testCase => {
                const converted = convertInterviewType(testCase);
                result += `è¾“å…¥: "${testCase}" â†’ è¾“å‡º: "${converted}"\n`;
            });
            
            resultDiv.textContent = result;
        }
        
        // è·å–æ ¼å¼åŒ–è®°å½•
        async function getFormattedRecords() {
            const resultDiv = document.getElementById('formattedResult');
            resultDiv.style.display = 'block';
            
            if (!authToken) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = 'âŒ è¯·å…ˆç™»å½•è·å–Token';
                return;
            }
            
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨è·å–å¹¶æ ¼å¼åŒ–è®°å½•...';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/interviews?page=1&per_page=50', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const convertInterviewType = (type) => {
                        const cleanType = type.includes('.') ? type.split('.').pop()?.toLowerCase() : type.toLowerCase();
                        switch (cleanType) {
                            case 'mock': return 'Mock Interview';
                            case 'technical':
                            case 'hr':
                            case 'comprehensive': return 'Formal interview';
                            default: return 'Mock Interview';
                        }
                    };
                    
                    const formatDate = (dateString) => {
                        const date = new Date(dateString);
                        return `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')}`;
                    };
                    
                    const formatDuration = (startTime, endTime) => {
                        if (!endTime) return 'æœªå®Œæˆ';
                        const start = new Date(startTime);
                        const end = new Date(endTime);
                        const diffMs = end.getTime() - start.getTime();
                        const minutes = Math.floor(diffMs / 60000);
                        const seconds = Math.floor((diffMs % 60000) / 1000);
                        return minutes > 0 ? `${minutes}min ${seconds}sec` : `${seconds}sec`;
                    };
                    
                    const formattedRecords = data.data.sessions.map(session => ({
                        id: session.session_id,
                        title: session.title || `${session.interview_type} Interview`,
                        date: formatDate(session.created_at),
                        duration: formatDuration(session.started_at || session.created_at, session.completed_at),
                        type: convertInterviewType(session.interview_type),
                        status: session.status,
                        raw_type: session.interview_type,
                        session
                    }));
                    
                    resultDiv.className = 'result-area success';
                    let result = `âœ… æ ¼å¼åŒ–æˆåŠŸï¼å…± ${formattedRecords.length} æ¡è®°å½•\n\n`;
                    
                    formattedRecords.forEach((record, index) => {
                        result += `${index + 1}. ${record.title}\n`;
                        result += `   ID: ${record.id}\n`;
                        result += `   åŸå§‹ç±»å‹: ${record.raw_type}\n`;
                        result += `   æ˜¾ç¤ºç±»å‹: ${record.type}\n`;
                        result += `   çŠ¶æ€: ${record.status}\n`;
                        result += `   æ—¥æœŸ: ${record.date}\n`;
                        result += `   æ—¶é•¿: ${record.duration}\n\n`;
                    });
                    
                    resultDiv.textContent = result;
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ è·å–å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // éªŒè¯ç›®æ ‡ä¼šè¯
        async function verifyTargetSession() {
            const resultDiv = document.getElementById('targetResult');
            resultDiv.style.display = 'block';
            
            if (!authToken) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = 'âŒ è¯·å…ˆç™»å½•è·å–Token';
                return;
            }
            
            const targetSessionId = 'ac5545af-1d34-41e5-b1da-e5fffa0bcacd';
            resultDiv.textContent = `ğŸ”„ æ­£åœ¨éªŒè¯ç›®æ ‡ä¼šè¯ ${targetSessionId}...`;
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/interviews?page=1&per_page=50', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const targetSession = data.data.sessions.find(s => s.session_id === targetSessionId);
                    
                    if (targetSession) {
                        const convertInterviewType = (type) => {
                            const cleanType = type.includes('.') ? type.split('.').pop()?.toLowerCase() : type.toLowerCase();
                            switch (cleanType) {
                                case 'mock': return 'Mock Interview';
                                case 'technical':
                                case 'hr':
                                case 'comprehensive': return 'Formal interview';
                                default: return 'Mock Interview';
                            }
                        };
                        
                        const displayType = convertInterviewType(targetSession.interview_type);
                        
                        resultDiv.className = 'result-area success';
                        resultDiv.textContent = `ğŸ¯ ç›®æ ‡ä¼šè¯éªŒè¯ç»“æœ:\n\n` +
                            `ä¼šè¯ID: ${targetSession.session_id}\n` +
                            `æ ‡é¢˜: ${targetSession.title}\n` +
                            `åŸå§‹ç±»å‹: ${targetSession.interview_type}\n` +
                            `æ˜¾ç¤ºç±»å‹: ${displayType}\n` +
                            `çŠ¶æ€: ${targetSession.status}\n` +
                            `åˆ›å»ºæ—¶é—´: ${targetSession.created_at}\n` +
                            `å¼€å§‹æ—¶é—´: ${targetSession.started_at}\n` +
                            `å®Œæˆæ—¶é—´: ${targetSession.completed_at}\n\n` +
                            `âœ… éªŒè¯ç»“æœ:\n` +
                            `ç±»å‹æ˜¾ç¤ºæ­£ç¡®: ${displayType === 'Mock Interview' ? 'âœ… æ˜¯' : 'âŒ å¦'}\n` +
                            `çŠ¶æ€æ­£ç¡®: ${targetSession.status === 'abandoned' ? 'âœ… æ˜¯' : 'âŒ å¦'}`;
                    } else {
                        resultDiv.className = 'result-area error';
                        resultDiv.textContent = `âŒ æœªæ‰¾åˆ°ç›®æ ‡ä¼šè¯ ${targetSessionId}`;
                    }
                } else {
                    resultDiv.className = 'result-area error';
                    resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`;
                }
            } catch (error) {
                resultDiv.className = 'result-area error';
                resultDiv.textContent = `âŒ éªŒè¯å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ¯ é¢è¯•è®°å½•æ˜¾ç¤ºä¿®å¤éªŒè¯é¡µé¢å·²åŠ è½½');
            console.log('è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•ï¼š1. ç™»å½• â†’ 2. è·å–åŸå§‹æ•°æ® â†’ 3. æµ‹è¯•è½¬æ¢ â†’ 4. æ ¼å¼åŒ–è®°å½• â†’ 5. éªŒè¯ç›®æ ‡ä¼šè¯');
        });
    </script>
</body>
</html> 