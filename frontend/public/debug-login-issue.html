<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é”™è¯¯å¤„ç†è°ƒè¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-8">ç™»å½•é”™è¯¯å¤„ç†è°ƒè¯•å·¥å…·</h1>
            
            <!-- æµ‹è¯•åŒºåŸŸ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">APIæµ‹è¯•</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <button onclick="testCorrectLogin()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">
                        æµ‹è¯•æ­£ç¡®ç™»å½• (123456)
                    </button>
                    <button onclick="testWrongPassword()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">
                        æµ‹è¯•é”™è¯¯å¯†ç 
                    </button>
                    <button onclick="testInvalidEmail()" class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded">
                        æµ‹è¯•ä¸å­˜åœ¨é‚®ç®±
                    </button>
                    <button onclick="testServerError()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded">
                        æµ‹è¯•æœåŠ¡å™¨é”™è¯¯
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">è‡ªå®šä¹‰æµ‹è¯•:</label>
                    <div class="flex gap-2">
                        <input type="email" id="customEmail" placeholder="é‚®ç®±" class="flex-1 border rounded px-3 py-2" value="test@example.com">
                        <input type="password" id="customPassword" placeholder="å¯†ç " class="flex-1 border rounded px-3 py-2">
                        <button onclick="testCustomLogin()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">æµ‹è¯•</button>
                    </div>
                </div>
            </div>
            
            <!-- æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">è°ƒè¯•æ—¥å¿—</h2>
                <div id="debugLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-96 overflow-y-auto"></div>
                <button onclick="clearLog()" class="mt-2 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5001/api/v1';
        const debugLog = document.getElementById('debugLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : 
                         type === 'success' ? 'text-green-400' : 
                         type === 'warning' ? 'text-yellow-400' : 'text-blue-400';
            
            debugLog.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        function clearLog() {
            debugLog.innerHTML = '';
        }
        
        async function makeLoginRequest(email, password) {
            try {
                log(`ğŸš€ å¼€å§‹ç™»å½•è¯·æ±‚: ${email}`, 'info');
                log(`ğŸ“¡ APIåœ°å€: ${API_BASE}/auth/login`, 'info');
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                log(`ğŸ“Š HTTPçŠ¶æ€: ${response.status} ${response.statusText}`, 
                    response.ok ? 'success' : 'error');
                
                const data = await response.json();
                log(`ğŸ“„ å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'info');
                
                if (!response.ok) {
                    log(`âŒ ç™»å½•å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    
                    // æµ‹è¯•é”™è¯¯ä¿¡æ¯å¤„ç†é€»è¾‘
                    testErrorMessageHandling(data.message || 'ç™»å½•å¤±è´¥');
                } else {
                    log(`âœ… ç™»å½•æˆåŠŸ!`, 'success');
                }
                
                return { response, data };
                
            } catch (error) {
                log(`ğŸ’¥ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
                testErrorMessageHandling(error.message);
                throw error;
            }
        }
        
        function testErrorMessageHandling(errorMsg) {
            log(`ğŸ”§ æµ‹è¯•é”™è¯¯æ¶ˆæ¯å¤„ç†é€»è¾‘...`, 'warning');
            log(`åŸå§‹é”™è¯¯: "${errorMsg}"`, 'warning');
            
            let friendlyErrorMessage = '';
            
            if (errorMsg.includes('ç”¨æˆ·ä¸å­˜åœ¨') || errorMsg.includes('ç”¨æˆ·åä¸å­˜åœ¨') || 
                errorMsg.includes('User not found') || errorMsg.includes('does not exist')) {
                friendlyErrorMessage = 'è¯¥é‚®ç®±å°šæœªæ³¨å†Œï¼Œè¯·æ£€æŸ¥é‚®ç®±åœ°å€æˆ–ç‚¹å‡»ä¸‹æ–¹"Sign up"æ³¨å†Œæ–°è´¦æˆ·';
            } else if (errorMsg.includes('å¯†ç é”™è¯¯') || errorMsg.includes('å¯†ç ä¸æ­£ç¡®') || 
                       errorMsg.includes('Incorrect password') || errorMsg.includes('Invalid password') ||
                       errorMsg.includes('password is incorrect')) {
                friendlyErrorMessage = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥æ­£ç¡®å¯†ç ';
            } else if (errorMsg.includes('ç”¨æˆ·è´¦å·å·²è¢«ç¦ç”¨') || errorMsg.includes('è´¦å·è¢«ç¦ç”¨') ||
                       errorMsg.includes('account is disabled') || errorMsg.includes('user is disabled')) {
                friendlyErrorMessage = 'æ‚¨çš„è´¦æˆ·å·²è¢«ç¦ç”¨ï¼Œè¯·è”ç³»å®¢æœå¤„ç†';
            } else if (errorMsg.includes('ç½‘ç»œ') || errorMsg.includes('Network') || errorMsg.includes('network')) {
                friendlyErrorMessage = 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•';
            } else if (errorMsg.includes('æœåŠ¡å™¨') || errorMsg.includes('Server') || errorMsg.includes('server')) {
                friendlyErrorMessage = 'æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
            } else {
                friendlyErrorMessage = errorMsg || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
            
            log(`ğŸ¯ å¤„ç†åçš„å‹å¥½é”™è¯¯ä¿¡æ¯: "${friendlyErrorMessage}"`, 'success');
            
            // æ¨¡æ‹Ÿå‰ç«¯æ˜¾ç¤ºé”™è¯¯
            showError(friendlyErrorMessage);
        }
        
        function showError(message) {
            // åˆ›å»ºä¸´æ—¶é”™è¯¯æ˜¾ç¤º
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50';
            errorDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">âŒ</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">Ã—</button>
                </div>
            `;
            document.body.appendChild(errorDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        }
        
        async function testCorrectLogin() {
            log('='.repeat(50), 'info');
            log('ğŸ§ª æµ‹è¯•æ­£ç¡®ç™»å½•', 'info');
            await makeLoginRequest('test@example.com', '123456');
        }
        
        async function testWrongPassword() {
            log('='.repeat(50), 'info');
            log('ğŸ§ª æµ‹è¯•é”™è¯¯å¯†ç ', 'info');
            await makeLoginRequest('test@example.com', 'wrongpassword');
        }
        
        async function testInvalidEmail() {
            log('='.repeat(50), 'info');
            log('ğŸ§ª æµ‹è¯•ä¸å­˜åœ¨çš„é‚®ç®±', 'info');
            await makeLoginRequest('notexist@example.com', '123456');
        }
        
        async function testServerError() {
            log('='.repeat(50), 'info');
            log('ğŸ§ª æµ‹è¯•æœåŠ¡å™¨é”™è¯¯ (ä½¿ç”¨æ— æ•ˆAPI)', 'info');
            try {
                const response = await fetch(`${API_BASE}/auth/invalid-endpoint`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'test@example.com', password: '123456' })
                });
                log(`æœåŠ¡å™¨å“åº”: ${response.status}`, 'error');
            } catch (error) {
                log(`ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        async function testCustomLogin() {
            const email = document.getElementById('customEmail').value;
            const password = document.getElementById('customPassword').value;
            
            if (!email || !password) {
                log('âŒ è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }
            
            log('='.repeat(50), 'info');
            log(`ğŸ§ª è‡ªå®šä¹‰æµ‹è¯•: ${email}`, 'info');
            await makeLoginRequest(email, password);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ‰ ç™»å½•é”™è¯¯å¤„ç†è°ƒè¯•å·¥å…·å·²åŠ è½½', 'success');
            log(`ğŸ”— APIåœ°å€: ${API_BASE}`, 'info');
            log('ğŸ“ è¯·é€‰æ‹©æµ‹è¯•åœºæ™¯å¼€å§‹è°ƒè¯•...', 'info');
        });
    </script>
</body>
</html> 