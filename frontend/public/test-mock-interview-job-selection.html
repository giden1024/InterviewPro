<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Interview èŒä½é€‰æ‹©åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        .section {
            margin-bottom: 32px;
        }
        .section h3 {
            color: #1f2937;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .test-step {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .test-step h4 {
            margin: 0 0 8px 0;
            color: #2563eb;
        }
        .test-step p {
            margin: 8px 0;
            color: #475569;
        }
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 4px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #2563eb;
        }
        .button.secondary {
            background: #6b7280;
        }
        .button.success {
            background: #10b981;
        }
        .result {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.running {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
        }
        .status.error {
            background: #fee2e2;
            color: #dc2626;
        }
        .log {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Mock Interview èŒä½é€‰æ‹©åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•æ–°çš„èŒä½é€‰æ‹©å’Œç®€å†å…³è”åŠŸèƒ½</p>
        </div>

        <div class="section">
            <h3>ğŸ”§ æœåŠ¡çŠ¶æ€æ£€æŸ¥</h3>
            <div class="test-step">
                <h4>åç«¯æœåŠ¡çŠ¶æ€</h4>
                <button class="button" onclick="checkBackendStatus()">æ£€æŸ¥åç«¯æœåŠ¡</button>
                <div id="backend-status" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-step">
                <h4>å‰ç«¯æœåŠ¡çŠ¶æ€</h4>
                <button class="button" onclick="checkFrontendStatus()">æ£€æŸ¥å‰ç«¯æœåŠ¡</button>
                <div id="frontend-status" class="result" style="display: none;"></div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ‘¤ ç”¨æˆ·è®¤è¯</h3>
            <div class="test-step">
                <h4>å¼€å‘è€…ç™»å½•</h4>
                <p>ä½¿ç”¨å¼€å‘è€…APIè¿›è¡Œå¿«é€Ÿç™»å½•</p>
                <button class="button" onclick="devLogin()">å¼€å‘è€…ç™»å½•</button>
                <div id="auth-status" class="result" style="display: none;"></div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“Š æ•°æ®å‡†å¤‡</h3>
            <div class="test-step">
                <h4>æ£€æŸ¥ç”¨æˆ·æ•°æ®</h4>
                <p>æ£€æŸ¥ç”¨æˆ·çš„èŒä½å’Œç®€å†æ•°æ®</p>
                <button class="button" onclick="checkUserData()">æ£€æŸ¥æ•°æ®</button>
                <div id="user-data" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-step">
                <h4>åˆ›å»ºæµ‹è¯•æ•°æ®</h4>
                <p>å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ›å»ºæµ‹è¯•èŒä½å’Œç®€å†</p>
                <button class="button success" onclick="createTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
                <div id="test-data" class="result" style="display: none;"></div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ¯ Mock Interview åŠŸèƒ½æµ‹è¯•</h3>
            <div class="test-step">
                <h4>è®¿é—®HomePage</h4>
                <p>æ‰“å¼€HomePageå¹¶æµ‹è¯•Mock InterviewæŒ‰é’®</p>
                <a href="http://localhost:3000/home" target="_blank" class="button">æ‰“å¼€HomePage</a>
            </div>
            
            <div class="test-step">
                <h4>æµ‹è¯•èŒä½é€‰æ‹©å¼¹çª—</h4>
                <p>ç‚¹å‡»Mock InterviewæŒ‰é’®åº”è¯¥å¼¹å‡ºèŒä½é€‰æ‹©å¼¹çª—ï¼Œæ˜¾ç¤ºå¯é€‰çš„èŒä½å’Œç®€å†</p>
                <div class="result">
                    <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
                    <ul>
                        <li>âœ… ç‚¹å‡»"Mock Interview"æŒ‰é’®å¼¹å‡ºé€‰æ‹©å¼¹çª—</li>
                        <li>âœ… æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰èŒä½åˆ—è¡¨</li>
                        <li>âœ… æ˜¾ç¤ºç”¨æˆ·å·²å¤„ç†å®Œæˆçš„ç®€å†åˆ—è¡¨</li>
                        <li>âœ… ç”¨æˆ·å¯ä»¥é€‰æ‹©èŒä½å’Œç®€å†</li>
                        <li>âœ… é€‰æ‹©åæ˜¾ç¤ºé…ç½®ç¡®è®¤ä¿¡æ¯</li>
                        <li>âœ… ç‚¹å‡»"å¼€å§‹æ¨¡æ‹Ÿé¢è¯•"åˆ›å»ºé¢è¯•ä¼šè¯</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
            <div class="test-step">
                <button class="button secondary" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                <button class="button secondary" onclick="exportLog()">å¯¼å‡ºæ—¥å¿—</button>
                <div id="test-log" class="log"></div>
            </div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('auth_token');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('test-log');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }

        function exportLog() {
            const logContent = document.getElementById('test-log').textContent;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mock-interview-test-${new Date().toISOString().slice(0,10)}.log`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function checkBackendStatus() {
            const statusDiv = document.getElementById('backend-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span class="status running">æ£€æŸ¥ä¸­...</span>';
            
            try {
                const response = await fetch('http://localhost:5001/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="success">
                            <span class="status success">è¿è¡Œæ­£å¸¸</span>
                            <p>æœåŠ¡: ${data.service}</p>
                            <p>çŠ¶æ€: ${data.status}</p>
                        </div>
                    `;
                    log('åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        <span class="status error">è¿æ¥å¤±è´¥</span>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
                log(`åç«¯æœåŠ¡æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function checkFrontendStatus() {
            const statusDiv = document.getElementById('frontend-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span class="status running">æ£€æŸ¥ä¸­...</span>';
            
            try {
                const response = await fetch('http://localhost:3000/');
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="success">
                            <span class="status success">è¿è¡Œæ­£å¸¸</span>
                            <p>å‰ç«¯å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ</p>
                        </div>
                    `;
                    log('å‰ç«¯æœåŠ¡è¿è¡Œæ­£å¸¸', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        <span class="status error">è¿æ¥å¤±è´¥</span>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
                log(`å‰ç«¯æœåŠ¡æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function devLogin() {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span class="status running">ç™»å½•ä¸­...</span>';
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/dev/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        username: 'testuser'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.data.access_token;
                    localStorage.setItem('auth_token', authToken);
                    
                    statusDiv.innerHTML = `
                        <div class="success">
                            <span class="status success">ç™»å½•æˆåŠŸ</span>
                            <p>ç”¨æˆ·: ${data.data.user.username} (${data.data.user.email})</p>
                            <p>Token: ${authToken.substring(0, 20)}...</p>
                        </div>
                    `;
                    log(`ç”¨æˆ·ç™»å½•æˆåŠŸ: ${data.data.user.username}`, 'success');
                } else {
                    throw new Error(data.message || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        <span class="status error">ç™»å½•å¤±è´¥</span>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
                log(`ç™»å½•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function checkUserData() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const statusDiv = document.getElementById('user-data');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span class="status running">æ£€æŸ¥ä¸­...</span>';
            
            try {
                // å¹¶è¡Œè·å–èŒä½å’Œç®€å†æ•°æ®
                const [jobsResponse, resumesResponse] = await Promise.all([
                    fetch('http://localhost:5001/api/v1/jobs?per_page=50', {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    }),
                    fetch('http://localhost:5001/api/v1/resumes?per_page=50', {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    })
                ]);
                
                const jobsData = await jobsResponse.json();
                const resumesData = await resumesResponse.json();
                
                const jobs = jobsData.success ? jobsData.data.jobs : [];
                const resumes = resumesData.success ? resumesData.data.resumes : [];
                const processedResumes = resumes.filter(r => r.status === 'completed' || r.status === 'processed');
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <span class="status success">æ•°æ®æ£€æŸ¥å®Œæˆ</span>
                        <p>ğŸ“‹ èŒä½æ•°é‡: ${jobs.length}</p>
                        <p>ğŸ“„ ç®€å†æ•°é‡: ${resumes.length} (å·²å¤„ç†: ${processedResumes.length})</p>
                        <details style="margin-top: 12px;">
                            <summary>è¯¦ç»†ä¿¡æ¯</summary>
                            <div style="margin-top: 8px;">
                                <strong>èŒä½åˆ—è¡¨:</strong>
                                ${jobs.length > 0 ? jobs.map(job => `<br>â€¢ ${job.title} @ ${job.company}`).join('') : '<br>æš‚æ— èŒä½'}
                                <br><br>
                                <strong>ç®€å†åˆ—è¡¨:</strong>
                                ${resumes.length > 0 ? resumes.map(resume => `<br>â€¢ ${resume.filename} (${resume.status})`).join('') : '<br>æš‚æ— ç®€å†'}
                            </div>
                        </details>
                    </div>
                `;
                
                log(`æ•°æ®æ£€æŸ¥å®Œæˆ - èŒä½: ${jobs.length}, ç®€å†: ${resumes.length} (å·²å¤„ç†: ${processedResumes.length})`, 'success');
                
                if (jobs.length === 0 || processedResumes.length === 0) {
                    log('å»ºè®®åˆ›å»ºæµ‹è¯•æ•°æ®ä»¥è¿›è¡Œå®Œæ•´æµ‹è¯•', 'info');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        <span class="status error">æ£€æŸ¥å¤±è´¥</span>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
                log(`æ•°æ®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function createTestData() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const statusDiv = document.getElementById('test-data');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span class="status running">åˆ›å»ºä¸­...</span>';
            
            try {
                log('å¼€å§‹åˆ›å»ºæµ‹è¯•æ•°æ®...', 'info');
                
                // 1. åˆ›å»ºæµ‹è¯•ç®€å†
                log('åˆ›å»ºæµ‹è¯•ç®€å†...', 'info');
                const resumeFormData = new FormData();
                const resumeBlob = new Blob(['æµ‹è¯•ç®€å†å†…å®¹ - è½¯ä»¶å·¥ç¨‹å¸ˆ\næŠ€èƒ½: JavaScript, React, Node.js, Python\nç»éªŒ: 3å¹´å¼€å‘ç»éªŒ'], { type: 'text/plain' });
                resumeFormData.append('file', resumeBlob, 'test_resume.txt');
                
                const resumeResponse = await fetch('http://localhost:5001/api/v1/resumes', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: resumeFormData
                });
                
                const resumeData = await resumeResponse.json();
                if (!resumeResponse.ok) throw new Error(`ç®€å†ä¸Šä¼ å¤±è´¥: ${resumeData.message}`);
                
                const resumeId = resumeData.data.resume.id;
                log(`ç®€å†åˆ›å»ºæˆåŠŸ (ID: ${resumeId})`, 'success');
                
                // 2. åˆ†æç®€å†
                log('åˆ†æç®€å†...', 'info');
                const analyzeResponse = await fetch(`http://localhost:5001/api/v1/resumes/${resumeId}/analyze`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const analyzeData = await analyzeResponse.json();
                if (!analyzeResponse.ok) throw new Error(`ç®€å†åˆ†æå¤±è´¥: ${analyzeData.message}`);
                
                log('ç®€å†åˆ†æå®Œæˆ', 'success');
                
                // 3. åˆ›å»ºæµ‹è¯•èŒä½
                log('åˆ›å»ºæµ‹è¯•èŒä½...', 'info');
                const jobData = {
                    title: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ',
                    company: 'TechCorp',
                    location: 'åŒ—äº¬',
                    salary_range: '15k-25k',
                    description: 'è´Ÿè´£å‰ç«¯å¼€å‘å·¥ä½œï¼Œè¦æ±‚ç†Ÿæ‚‰Reactã€TypeScriptç­‰æŠ€æœ¯æ ˆ',
                    requirements: ['React', 'TypeScript', 'JavaScript', 'HTML/CSS'],
                    job_type: 'full_time',
                    experience_level: 'mid_level'
                };
                
                const jobResponse = await fetch('http://localhost:5001/api/v1/jobs', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jobData)
                });
                
                const jobResult = await jobResponse.json();
                if (!jobResponse.ok) throw new Error(`èŒä½åˆ›å»ºå¤±è´¥: ${jobResult.message}`);
                
                const jobId = jobResult.data.job.id;
                log(`èŒä½åˆ›å»ºæˆåŠŸ (ID: ${jobId})`, 'success');
                
                // 4. åˆ›å»ºç¬¬äºŒä¸ªèŒä½
                const job2Data = {
                    title: 'å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ',
                    company: 'StartupCo',
                    location: 'ä¸Šæµ·',
                    salary_range: '20k-30k',
                    description: 'è´Ÿè´£å…¨æ ˆå¼€å‘å·¥ä½œï¼Œå‰åç«¯éƒ½è¦ç†Ÿæ‚‰',
                    requirements: ['Node.js', 'React', 'Python', 'Database'],
                    job_type: 'full_time',
                    experience_level: 'senior_level'
                };
                
                const job2Response = await fetch('http://localhost:5001/api/v1/jobs', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(job2Data)
                });
                
                const job2Result = await job2Response.json();
                if (!job2Response.ok) throw new Error(`ç¬¬äºŒä¸ªèŒä½åˆ›å»ºå¤±è´¥: ${job2Result.message}`);
                
                const job2Id = job2Result.data.job.id;
                log(`ç¬¬äºŒä¸ªèŒä½åˆ›å»ºæˆåŠŸ (ID: ${job2Id})`, 'success');
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <span class="status success">æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸ</span>
                        <p>âœ… åˆ›å»ºäº†1ä¸ªç®€å† (ID: ${resumeId})</p>
                        <p>âœ… åˆ›å»ºäº†2ä¸ªèŒä½ (ID: ${jobId}, ${job2Id})</p>
                        <p>âœ… ç°åœ¨å¯ä»¥æµ‹è¯•Mock InterviewåŠŸèƒ½äº†</p>
                    </div>
                `;
                
                log('æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•Mock InterviewåŠŸèƒ½', 'success');
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        <span class="status error">åˆ›å»ºå¤±è´¥</span>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
                log(`æµ‹è¯•æ•°æ®åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('Mock Interview èŒä½é€‰æ‹©åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            if (authToken) {
                log('æ£€æµ‹åˆ°å·²ä¿å­˜çš„è®¤è¯token', 'info');
            } else {
                log('æœªæ£€æµ‹åˆ°è®¤è¯tokenï¼Œè¯·å…ˆç™»å½•', 'info');
            }
        });
    </script>
</body>
</html> 